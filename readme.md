# RHManagedObject

RHManagedObject is a simplified library for Core Data on iOS.  It was motivated by the following:

- Core Data is verbose.  Have a look at [Listing 1](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/CoreData/Articles/cdFetching.html) from the Apple Documentation and you'll see it takes ~14 lines of code for a single fetch request.  `RHManagedObject` reduces this to one line of code.
- Core Data is not thread safe. If you wish to interact with your objects off the main thread you need to create a separate object context, attach a `NSManagedObjectContextDidSaveNotification` notification to it, and merge the context into the observer method on the main thread when performing a save.  `RHManagedObject` does all of this for you so that you can work with your objects transparently in any thread.  
- Each managed object has an object context associated with it, and for some operations you must first fetch the object context in order to operate on the object. For example:

	``` objective-c
	NSManagedObjectContext *moc = [myManagedObject managedObjectContext];
	[moc deleteObject:myManagedObject];
	```

	This is more verbose than necessary since it introduces the object context when its existence is implied by the managed object. `RHManagedObject` replaces the above code with:

	``` objective-c
	[myManagedObject delete];
	```
	
	`RHManagedObject` makes it possible to interact with Core Data objects without having to ever interact with the object context.

- The generated managed object classes leave no room to add additional methods. You can’t (or shouldn’t) add extra methods to the generated classes since they will be overridden when the classes are regenerated. `RHManagedObject` provides a place for additional class and instance methods.
- The AppDelegate gets polluted with boilerplate code. `RHManagedObject` most of the underlying boilerplate Core Data code, which also makes it easier to copy the library to other projects.

## How To Get Started

- [Download RHManagedObject](https://github.com/chriscdn/RHManagedObject/zipball/master)
- Copy `RHManagedObject.h`, `RHManagedObject.m`, `RHManagedObjectContextManager.h`, and `RHManagedObjectContextManager.m` into your project

## Overview by Example

This brief tutorial assumes you have some experience with Core Data.

A typical Core Data "Employee" entity (say, with attributes firstName and lastName) has an inheritance hierarchy of:

	NSObject :: NSManagedObject :: EmployeeEntity

`RHManagedObject` changes this to:

	NSObject :: NSManagedObject :: RHManagedObject :: EmployeeEntity :: Employee
	
You’ll notice that the `RHManagedObject` and `Employee` classes have been added to the hierarchy. The `RHManagedObject` class adds generic methods (i.e., not specific to your model) that simplifies interacting with Core Data. Its main features are:

- It manages the moc for you such that you don’t have to think about it.
- It adds easier methods for fetching, creating, cloning, and deleting managed objects.
- It provides a simplified interface for saving the context, and works regardless from which thread it’s called.

For example, the newEntity method introduced in `RHManagedObject` lets you create a new managed object with a single line:

``` objective-c
Employee *newEmployee = [Employee newEntity];
```

Fetching all employees with first name "John" is also a single line:

``` objective-c
NSArray *employees = [Employee fetchWithPredicate:[NSPredicate predicateWithFormat:@"firstName=%@", @"John"]];
```

The delete method lets you delete an existing managed object:

``` objective-c
[firedEmployee delete];
```

Changes can be saved with the commit method, which will handle all the nuances of creating and merging the contexts from different threads. In other words, you can call `commit` from your thread and forget about it:

``` objective-c
[RHManagedObject commit];
// or
[Employee commit];
```

You’ll notice that none of these examples require direct use of a `NSManagedObjectContext`. That’s handled for you within the framework. Of course, a method is available to fetch the moc for the current thread if it’s required:

``` objective-c
NSManagedObjectContext *moc = [RHManagedObject managedObjectContext];
```

The `EmployeeEntity` class is still generated by Xcode, but is manually edited to inherit from `RHManagedObjectClass` instead of `NSManagedObjectClass`. It's a small hack, but only means changing two lines of code. Also, the object graph (defined in the xcdatamodeld file) must be slightly modified before and after the entity classes are generated. More on that later.

The `Employee` class requires two methods to identify which Core Data entity it extends and to which model it belongs. This is used by `RHManagedObjectContext`, and looks like this:

``` objective-c
+(NSString *)entityName {
    return @”EmployeeEntity”;
}

// This returns the name of your xcdatamodeld model, without the extension
+(NSString *)modelName {
	return @"SimplifiedCoreDataExample";
}
```

However, it’s also the place where additional methods can be added without disrupting the generated entity class. For example:

``` objective-c
-(NSString *)fullName {
    return [NSString stringWithFormat:@"%@ %@", self.firstName, self.lastName];
}
```

The framework also contains a singleton class called `RHManagedObjectContextManager`, which contains the Core Data boilerplate code that’s normally found in the AppDelegate. It also handles the managed object contexts among the different threads, and the merging of contexts when saving. Fortunately, you can ignore this class since it’s only used internally by the framework.

Lastly, the framework also contains code to populate the store on first launch. This was motivated by the [CoreDataBooks example](http://developer.apple.com/library/ios/#samplecode/CoreDataBooks/Introduction/Intro.html), so all you have to do is copy the sqlite file generated by the simulator into your project. The framework takes care of the rest.